# name: test/sql/llama_no_model_required.test
# description: Test all functions that don't require a loaded model
# group: [sql]

require llama

# Test 1: Extension loads successfully
statement ok
SELECT 'LLaMA extension test starting';

# Test 2: GPU info function (no model required)
query I
SELECT llama_gpu_info() IS NOT NULL;
----
true

# Test 3: Status function (no model required)
query I
SELECT llama_status() IS NOT NULL;
----
true

# Test 4: List models function (no model required)
query I
SELECT llama_list_models() IS NOT NULL;
----
true

# Test 5: List loaded models (no model required, should be empty)
query I
SELECT llama_list_loaded() IS NOT NULL;
----
true

# Test 6: GPU info should contain expected fields
query I
SELECT llama_gpu_info() LIKE '%gpu_support%';
----
true

# Test 7: Status should contain extension info
query I
SELECT llama_status() LIKE '%Extension%' OR llama_status() LIKE '%Status%';
----
true

# Test 8: Check if Vulkan is detected (from our build)
query I
SELECT llama_gpu_info() LIKE '%device_count%';
----
true

# Test 9: Attempt to use function that requires model (should fail gracefully)
query I
SELECT llama_generate('nonexistent-model', 'test') LIKE '%Error%' OR llama_generate('nonexistent-model', 'test') LIKE '%not found%' OR llama_generate('nonexistent-model', 'test') LIKE '%not loaded%';
----
true

# Test 10: Attempt to get info for nonexistent model (should fail gracefully)
query I
SELECT llama_model_info('nonexistent-model') LIKE '%Error%' OR llama_model_info('nonexistent-model') LIKE '%not found%' OR llama_model_info('nonexistent-model') IS NULL;
----
true

# Test 11: Attempt to unload nonexistent model (should fail gracefully)
query I
SELECT llama_unload_model('nonexistent-model') LIKE '%not found%' OR llama_unload_model('nonexistent-model') LIKE '%Failed%';
----
true

# Test completed successfully
statement ok
SELECT 'No-model tests completed successfully';
